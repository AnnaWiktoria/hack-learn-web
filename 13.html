<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lekcja 13: File Upload - Kurs Pentestera</title>

    <link rel="stylesheet" href="style.css">

    <style>
        /* Akcent: Biohazard Purple (Malicious Files / Infection) */
        :root {
            --accent: #ea00d9;
            --accent-glow: rgba(234, 0, 217, 0.3);
        }

        .extension {
            color: #00e5ff;
            font-weight: bold;
        }

        .magic-bytes {
            color: #ffd600;
            font-family: monospace;
        }
    </style>
</head>

<body>

    <div class="container">
        <header>
            <h1>FILE UPLOAD ATTACKS</h1>
            <p>MODU≈Å 13: Webshelle, Magic Bytes i Omijanie Filtr√≥w</p>
        </header>

        <!-- 1. MECHANIZM -->
        <section>
            <h2>> NIEBEZPIECZNY IMPORT</h2>
            <p>Funkcja wgrywania plik√≥w (awatary, CV, dokumenty) to krytyczny punkt ataku. Je≈õli serwer nie sprawdzi
                dok≈Çadnie, CO wgrywasz, mo≈ºesz przejƒÖƒá nad nim kontrolƒô.</p>

            <div class="card">
                <h3>CEL: WEBSHELL</h3>
                <p>Nie chcemy wgraƒá wirusa. Chcemy wgraƒá ma≈Çy skrypt (Webshell), kt√≥ry pozwoli nam wykonywaƒá komendy
                    systemowe przez przeglƒÖdarkƒô.</p>
                <pre><code><span class="comment">// Najprostszy shell w PHP (shell.php):</span>
&lt;?php system($_GET['cmd']); ?&gt;</code></pre>
                <p><strong>Scenariusz:</strong></p>
                <ol>
                    <li>Wgrywasz plik <code>shell.php</code> jako sw√≥j "awatar".</li>
                    <li>Otwierasz go w przeglƒÖdarce: <code>site.com/uploads/shell.php?cmd=whoami</code>.</li>
                    <li>Serwer wykonuje kod PHP i zwraca wynik: <code>root</code>. Masz RCE.</li>
                </ol>
            </div>
        </section>

        <!-- 2. OMIJANIE FILTR√ìW -->
        <section>
            <h2>> GRA W KOTKA I MYSZKƒò (BYPASS)</h2>
            <p>Programi≈õci pr√≥bujƒÖ blokowaƒá pliki <code>.php</code>. Jak ich oszukaƒá?</p>

            <div class="card">
                <h3>1. ZMIANA ROZSZERZENIA (Blacklist Bypass)</h3>
                <p>Je≈õli serwer blokuje <code>.php</code>, spr√≥buj alternatyw, kt√≥re serwer WWW nadal mo≈ºe wykonaƒá:</p>
                <ul>
                    <li>PHP: <span class="extension">.php5, .phtml, .phar, .php7</span></li>
                    <li>JSP: <span class="extension">.jspx, .jsw, .jsv</span></li>
                    <li>ASP: <span class="extension">.cer, .asa, .aspx</span></li>
                </ul>
            </div>

            <div class="card">
                <h3>2. ZMIANA CONTENT-TYPE</h3>
                <p>Serwer czƒôsto ufa temu, co m√≥wi przeglƒÖdarka. W Burp Suite mo≈ºesz przechwyciƒá ≈ºƒÖdanie i zmieniƒá typ
                    pliku bez zmiany jego tre≈õci.</p>
                <pre><code><span class="comment"># Orygina≈Ç:</span>
Content-Type: application/x-php

<span class="comment"># Zmiana (oszukujemy serwer):</span>
Content-Type: image/jpeg</code></pre>
            </div>

            <div class="card">
                <h3>3. MAGIC BYTES (Sygnatury plik√≥w)</h3>
                <p>Bardziej zaawansowane serwery sprawdzajƒÖ zawarto≈õƒá pliku. Pliki GIF zawsze zaczynajƒÖ siƒô od
                    <code>GIF89a</code>.</p>
                <p><strong>Atak (Polyglot):</strong> Doklejamy nag≈Ç√≥wek GIF do naszego skryptu PHP.</p>
                <pre><code><span class="magic-bytes">GIF89a</span>;
&lt;?php system($_GET['cmd']); ?&gt;</code></pre>
                <p>Serwer my≈õli: "To poprawny obrazek GIF". PHP my≈õli: "Wykonam kod po nag≈Ç√≥wku".</p>
            </div>
        </section>

        <!-- 3. ZAAWANSOWANE TECHNIKI -->
        <section>
            <h2>> EGZOTYCZNE PRZYPADKI</h2>

            <div class="card">
                <h3>DOUBLE EXTENSIONS & NULL BYTE</h3>
                <ul>
                    <li><strong>Apache Misconfiguration:</strong> Plik <code>shell.php.jpg</code> mo≈ºe zostaƒá wykonany
                        jako PHP, je≈õli serwer jest ≈∫le skonfigurowany (wykonuje pierwszƒÖ rozpoznanƒÖ ko≈Ñc√≥wkƒô).</li>
                    <li><strong>Null Byte Injection:</strong> <code>shell.php%00.jpg</code>. Serwer sprawdza ko≈Ñc√≥wkƒô
                        <code>.jpg</code> (jest OK), ale system plik√≥w ucina nazwƒô na znaku Null, zapisujƒÖc
                        <code>shell.php</code>.</li>
                </ul>
            </div>

            <div class="card">
                <h3>PUT METHOD</h3>
                <p>Czasami serwer ma w≈ÇƒÖczony protok√≥≈Ç WebDAV. Mo≈ºesz wgraƒá plik bez formularza:</p>
                <pre><code>PUT /uploads/hacker.php HTTP/1.1
Host: target.com
Content-Length: 20

&lt;?php phpinfo(); ?&gt;</code></pre>
            </div>
        </section>

        <!-- CHECKLIST -->
        <section>
            <h2>CHECKLISTA / RED FLAGS</h2>
            <div class="card checklist-card">
                <div class="checklist-item">
                    <span class="check-icon">‚ö†</span>
                    <div><strong>Katalog Upload√≥w dostƒôpny publicznie:</strong> Je≈õli mo≈ºesz otworzyƒá wgrany plik
                        bezpo≈õrednio w przeglƒÖdarce, to po≈Çowa sukcesu ataku.</div>
                </div>
                <div class="checklist-item">
                    <span class="check-icon">‚ö†</span>
                    <div><strong>Brak zmiany nazwy pliku:</strong> Serwer powinien zmieniaƒá nazwƒô na losowƒÖ (np.
                        uuid.jpg). Je≈õli zachowuje `shell.php`, to b≈ÇƒÖd.</div>
                </div>
                <div class="checklist-item">
                    <span class="check-icon">‚ö†</span>
                    <div><strong>SVG Upload:</strong> Pliki SVG to XML. Mo≈ºna w nich ukryƒá XSS (`&lt;script&gt;`) lub
                        XXE.</div>
                </div>
            </div>
        </section>

        <!-- QUIZ -->
        <section id="quiz-section">
            <h2>üéì WERYFIKACJA WIEDZY</h2>
            <div id="quiz-container"></div>
        </section>

        <footer>
            <p style="text-align: center; margin-top: 50px; color: #555;">&copy; 2026 Kurs Pentestera | Modu≈Ç 13</p>
        </footer>
    </div>

    <!-- DANE DO QUIZU -->
    <script>
        const quizData = [
            {
                question: "Co to jest Webshell?",
                options: [
                    "Z≈Ço≈õliwa strona internetowa.",
                    "Ma≈Çy skrypt (np. w PHP/ASP), kt√≥ry po wgraniu na serwer pozwala atakujƒÖcemu wykonywaƒá polecenia systemowe przez przeglƒÖdarkƒô.",
                    "Pow≈Çoka ochronna serwera.",
                    "Rodzaj bazy danych."
                ],
                correct: 1,
                explanation: "Webshell to 'tylne wej≈õcie' (Backdoor). Pozwala zarzƒÖdzaƒá serwerem tak, jakby≈õ siedzia≈Ç przy jego terminalu, u≈ºywajƒÖc zwyk≈Çych ≈ºƒÖda≈Ñ HTTP."
            },
            {
                type: "scenario",
                question: "Serwer blokuje pliki z rozszerzeniem '.php'. Jakiej alternatywy mo≈ºesz spr√≥bowaƒá na serwerze Apache/Linux?",
                options: [
                    ".exe",
                    ".phtml lub .php5",
                    ".jpg",
                    ".txt"
                ],
                correct: 1,
                explanation: "Czƒôsto konfiguracja serwera WWW instruuje go, by traktowa≈Ç `.phtml`, `.php5` czy `.phar` tak samo jak `.php` - czyli wykonywa≈Ç kod."
            },
            {
                question: "Co to sƒÖ 'Magic Bytes' (Sygnatura pliku)?",
                options: [
                    "Magiczne zaklƒôcia haker√≥w.",
                    "Pierwsze bajty pliku, kt√≥re identyfikujƒÖ jego format (np. GIF89a dla obrazk√≥w GIF, %PDF dla dokument√≥w PDF).",
                    "Rozszerzenie pliku.",
                    "Rozmiar pliku w bajtach."
                ],
                correct: 1,
                explanation: "Serwer mo≈ºe ignorowaƒá rozszerzenie i sprawdzaƒá nag≈Ç√≥wek pliku. AtakujƒÖcy mo≈ºe dodaƒá 'GIF89a' na poczƒÖtku skryptu PHP, aby oszukaƒá ten mechanizm."
            },
            {
                type: "scenario",
                question: "Przechwytujesz ≈ºƒÖdanie w Burp Suite. Widzisz nag≈Ç√≥wek 'Content-Type: application/x-php'. Na co go zmienisz, aby spr√≥bowaƒá oszukaƒá prosty filtr?",
                options: [
                    "application/json",
                    "image/jpeg lub image/png",
                    "text/plain",
                    "Na nic, zostawiam bez zmian."
                ],
                correct: 1,
                explanation: "Wiele aplikacji sprawdza TYLKO nag≈Ç√≥wek Content-Type wys≈Çany przez przeglƒÖdarkƒô. Haker mo≈ºe wys≈Çaƒá kod PHP, ale powiedzieƒá serwerowi: 'To jest zdjƒôcie'."
            },
            {
                question: "Dlaczego wgrywanie plik√≥w SVG jest ryzykowne?",
                options: [
                    "Bo sƒÖ du≈ºe.",
                    "SVG to format oparty na XML. Mo≈ºe zawieraƒá z≈Ço≈õliwy JavaScript (XSS) lub ataki na parser XML (XXE).",
                    "Bo majƒÖ s≈ÇabƒÖ jako≈õƒá.",
                    "Bo nie dzia≈ÇajƒÖ na telefonach."
                ],
                correct: 1,
                explanation: "SVG to nie jest 'zwyk≈Çy obrazek' (raster), to kod (wektor). PrzeglƒÖdarka interpretuje go i mo≈ºe wykonaƒá zawarty w nim kod JS (Stored XSS)."
            },
            {
                question: "Co to jest atak 'Polyglot' w kontek≈õcie File Upload?",
                options: [
                    "Plik wielojƒôzyczny.",
                    "Plik, kt√≥ry jest jednocze≈õnie poprawnym formatem A (np. obrazkiem GIF) i poprawnym formatem B (np. skryptem PHP).",
                    "Wgrywanie wielu plik√≥w naraz.",
                    "Szyfrowanie pliku."
                ],
                correct: 1,
                explanation: "Polyglot przechodzi walidacjƒô (bo jest obrazkiem) i wykonuje siƒô jako kod (bo zawiera PHP). To zaawansowana technika omijania zabezpiecze≈Ñ."
            },
            {
                question: "Jaka jest najlepsza obrona przed z≈Ço≈õliwym uploadem?",
                options: [
                    "Sprawdzanie rozszerzenia.",
                    "Zapisywanie plik√≥w poza katalogiem dostƒôpnym z webu (webroot), zmiana nazwy na losowƒÖ i usuwanie uprawnie≈Ñ do wykonywania (chmod -x).",
                    "U≈ºywanie antywirusa.",
                    "Blokowanie du≈ºych plik√≥w."
                ],
                correct: 1,
                explanation: "Je≈õli plik nie jest w folderze publicznym serwera WWW (np. /var/www/uploads), to nawet je≈õli jest wirusem, haker nie mo≈ºe go uruchomiƒá przez URL."
            },
            {
                type: "scenario",
                question: "Uda≈Ço Ci siƒô wgraƒá 'shell.php', ale serwer zmieni≈Ç jego nazwƒô na 'a1b2c3d4.jpg'. Czy atak siƒô uda≈Ç?",
                options: [
                    "Tak, masz RCE.",
                    "Niekoniecznie. Je≈õli serwer nie jest skonfigurowany do wykonywania plik√≥w .jpg jako PHP (co jest rzadkie) lub nie masz podatno≈õci LFI, to nie uruchomisz kodu.",
                    "Tak, bo plik jest na serwerze.",
                    "Zale≈ºy od przeglƒÖdarki."
                ],
                correct: 1,
                explanation: "Samo wgranie pliku to po≈Çowa sukcesu. Musisz zmusiƒá serwer do jego WYKONANIA. Pliki .jpg sƒÖ zazwyczaj tylko wy≈õwietlane, a nie interpretowane przez procesor PHP."
            },
            {
                question: "Co mo≈ºe oznaczaƒá plik o nazwie 'shell.php.jpg'?",
                options: [
                    "To wirus na Windowsa.",
                    "Pr√≥ba wykorzystania b≈Çƒôdu konfiguracji Apache (Double Extension), gdzie serwer wykonuje plik, je≈õli znajdzie w nazwie znane rozszerzenie (.php), nawet je≈õli nie jest ono ostatnie.",
                    "B≈ÇƒÖd u≈ºytkownika.",
                    "Plik skompresowany."
                ],
                correct: 1,
                explanation: "To stara, ale jara technika. Je≈õli Apache ma regu≈Çƒô `AddHandler php5-script .php`, to mo≈ºe wykonaƒá ka≈ºdy plik zawierajƒÖcy `.php` w nazwie."
            },
            {
                question: "Jak metoda HTTP PUT mo≈ºe byƒá wykorzystana do wgrania pliku?",
                options: [
                    "Nie mo≈ºe.",
                    "Je≈õli serwer ma w≈ÇƒÖczony WebDAV i jest ≈∫le skonfigurowany, PUT pozwala na bezpo≈õrednie zapisanie pliku pod wskazanym URL bez u≈ºycia formularza uploadu.",
                    "PUT s≈Çu≈ºy tylko do baz danych.",
                    "To dzia≈Ça tylko na FTP."
                ],
                correct: 1,
                explanation: "Narzƒôdzia skanujƒÖce (jak Nikto) czƒôsto sprawdzajƒÖ metody HTTP. Je≈õli wykryjƒÖ PUT, to potencjalnie autostrada do wgrania webshella."
            }
        ];
    </script>

    <script src="quiz.js"></script>

</body>

</html>