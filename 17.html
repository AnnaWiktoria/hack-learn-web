<!DOCTYPE html>
<html lang="pl">
<head>

     <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="AnnaWiktoria">
    <meta name="copyright" content="AnnaWiktoria">
    <meta name="description" content="Interaktywny kurs bezpieczeÅ„stwa aplikacji webowych. Licencja CC BY-NC-SA.">

    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; 
               style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; 
               font-src 'self' https://fonts.gstatic.com; 
               script-src 'self' 'unsafe-inline'; 
               img-src 'self' data:;">

    <title>Kurs bezpieczeÅ„stwa aplikacji webowych - Lekcja 17: Business Logic & Race Condition</title>
      
      <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">


    <style>
        /* Akcent: Phantom Indigo (Logic / Invisible Bugs) */
        :root {
            --accent: #7c4dff;
            --accent-glow: rgba(124, 77, 255, 0.3);
        }
        
        .step { color: #00e5ff; font-weight: bold; }
        .thread { color: #ffeb3b; font-family: monospace; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>LOGIC FLAWS & RACE CONDITIONS</h1>
        <p>MODUÅ 17: BÅ‚Ä™dy, ktÃ³rych nie widzÄ… skanery, WyÅ›cigi i Darmowe Zakupy</p>
    </header>

    <!-- 1. BUSINESS LOGIC FLAWS -->
    <section>
        <h2>> CZYNNIK LUDZKI (LOGIC FLAWS)</h2>
        <p>BÅ‚Ä™dy logiki biznesowej to sytuacje, w ktÃ³rych program dziaÅ‚a zgodnie z kodem, ale niezgodnie z zaÅ‚oÅ¼eniami biznesowymi. Skaner widzi "200 OK", pentester widzi "Darmowy iPhone".</p>
        
        <div class="card">
            <h3>PRZYKÅADY Z Å»YCIA</h3>
            <ul>
                <li><strong>Omijanie krokÃ³w (Workflow Bypass):</strong>
                    <br>Proces zakupu: <span class="step">1. Koszyk</span> -> <span class="step">2. PÅ‚atnoÅ›Ä‡</span> -> <span class="step">3. Potwierdzenie</span>.
                    <br>Atak: Haker dodaje towar do koszyka i od razu wchodzi na URL kroku 3 (<code>/checkout/success</code>). JeÅ›li system nie sprawdza statusu pÅ‚atnoÅ›ci -> towar wysÅ‚any.</li>
                
                <li><strong>Ujemne kwoty:</strong>
                    <br>Sklep pozwala wpisaÄ‡ iloÅ›Ä‡ towaru.
                    <br>Atak: Kupujesz <code>-1</code> laptopa. Sklep "oddaje" Ci pieniÄ…dze na saldo konta. Potem kupujesz coÅ› innego za te Å›rodki.</li>
                
                <li><strong>Modyfikacja ceny:</strong>
                    <br>Wybierasz taÅ„szy produkt A, przechwytujesz Å¼Ä…danie i podmieniasz ID na droÅ¼szy produkt B, liczÄ…c, Å¼e system policzy cenÄ™ z A, a wyÅ›le B.</li>
            </ul>
        </div>
    </section>

    <!-- 2. RACE CONDITIONS -->
    <section>
        <h2>> WYÅšCIGI (RACE CONDITIONS) ğŸï¸</h2>
        <p>Co siÄ™ stanie, jeÅ›li wykonasz tÄ™ samÄ… akcjÄ™ 50 razy w ciÄ…gu 10 milisekund? Serwer moÅ¼e "zgÅ‚upieÄ‡".</p>
        
        <div class="card">
            <h3>LIMIT OF ONE (Limit of... Infinity?)</h3>
            <p>Masz kupon jednorazowy "RABAT-50".</p>
            <p><strong>Logika serwera (uproszczona):</strong></p>
            <pre><code>1. SprawdÅº, czy kupon byÅ‚ uÅ¼yty.
2. JeÅ›li NIE: Zastosuj zniÅ¼kÄ™.
3. Oznacz kupon jako uÅ¼yty.</code></pre>
            
            <p><strong>Atak:</strong> WysyÅ‚asz 20 rÃ³wnolegÅ‚ych Å¼Ä…daÅ„ (Multi-threaded) w tym samym momencie.</p>
            <ul>
                <li><span class="thread">WÄ…tek 1</span>: Sprawdza (Czysty). Stosuje zniÅ¼kÄ™...</li>
                <li><span class="thread">WÄ…tek 2</span>: Sprawdza (Czysty - bo WÄ…tek 1 jeszcze nie zapisaÅ‚ zmiany!). Stosuje zniÅ¼kÄ™...</li>
                <li><span class="thread">WÄ…tek 3</span>: Sprawdza (Czysty)...</li>
            </ul>
            <p><strong>Efekt:</strong> ZastosowaÅ‚eÅ› zniÅ¼kÄ™ wielokrotnie, zanim baza danych zdÄ…Å¼yÅ‚a siÄ™ zaktualizowaÄ‡.</p>
        </div>

        <div class="card">
            <h3>NARZÄ˜DZIE: TURBO INTRUDER</h3>
            <p>RÄ™czne klikanie jest za wolne. W Burp Suite uÅ¼ywa siÄ™ wtyczki <strong>Turbo Intruder</strong>. Pozwala ona wysÅ‚aÄ‡ tysiÄ…ce Å¼Ä…daÅ„ w jednej "paczce" sieciowej, minimalizujÄ…c opÃ³Åºnienia (latency).</p>
        </div>
    </section>

    <!-- 3. TOCTOU -->
    <section>
        <h2>> TOCTOU (Time-Of-Check to Time-Of-Use)</h2>
        <p>To techniczna nazwa problemu wyÅ›cigÃ³w.</p>
        <div class="card">
            <p>PomiÄ™dzy momentem <strong>Sprawdzenia</strong> (Check: "Czy masz Å›rodki?"), a momentem <strong>UÅ¼ycia</strong> (Use: "Przelej Å›rodki") mija uÅ‚amek sekundy.</p>
            <p>W tym oknie czasowym stan systemu moÅ¼e siÄ™ zmieniÄ‡, ale program o tym nie wie. To "magiczne okno" dla hakera.</p>
        </div>
    </section>

    <!-- CHECKLIST -->
    <section>
        <h2>CHECKLISTA / RED FLAGS</h2>
        <div class="card checklist-card">
            <div class="checklist-item">
                <span class="check-icon">âš </span>
                <div><strong>Kupony i Karty Podarunkowe:</strong> Zawsze testuj Race Condition (uÅ¼ycie wielokrotne).</div>
            </div>
            <div class="checklist-item">
                <span class="check-icon">âš </span>
                <div><strong>Wieloetapowe formularze:</strong> SprÃ³buj pominÄ…Ä‡ krok 2 i przejÅ›Ä‡ od razu do 3. SprÃ³buj cofnÄ…Ä‡ siÄ™ z 3 do 1, zachowujÄ…c sesjÄ™.</div>
            </div>
            <div class="checklist-item">
                <span class="check-icon">âš </span>
                <div><strong>Limity (np. 3 lajki dziennie):</strong> Idealne miejsce na Race Condition.</div>
            </div>
             <div class="checklist-item">
                <span class="check-icon">âš </span>
                <div><strong>Operacje finansowe:</strong> WpÅ‚aty, wypÅ‚aty, przelewy. Co jeÅ›li przelejesz pieniÄ…dze na dwa konta jednoczeÅ›nie?</div>
            </div>
        </div>
    </section>

    <!-- QUIZ -->
    <section id="quiz-section">
        <h2>ğŸ“ WERYFIKACJA WIEDZY</h2>
        <div id="quiz-container"></div>
    </section>

    <footer>
        <p style="text-align: center; margin-top: 50px; color: #555;">&copy; 2026 Hack & Learn: Web Edition | ModuÅ‚ 17</p>
    </footer>
</div>

<!-- DANE DO QUIZU -->
<script>
    const quizData = [
        {
            question: "Dlaczego automatyczne skanery bezpieczeÅ„stwa (np. Nessus, Burp Scanner) rzadko wykrywajÄ… bÅ‚Ä™dy logiki biznesowej?",
            options: [
                "Bo skanery sÄ… przestarzaÅ‚e.",
                "PoniewaÅ¼ bÅ‚Ä™dy logiczne nie generujÄ… bÅ‚Ä™dÃ³w technicznych (np. 500 error) i sÄ… zgodne ze skÅ‚adniÄ… kodu. WymagajÄ… zrozumienia kontekstu biznesowego (np. 'cena nie moÅ¼e byÄ‡ ujemna').",
                "Bo logika biznesowa jest szyfrowana.",
                "Bo skanery nie obsÅ‚ugujÄ… JavaScript."
            ],
            correct: 1,
            explanation: "Skaner nie wie, Å¼e kupienie TV za 1 grosz jest bÅ‚Ä™dem. Dla skanera to po prostu poprawna transakcja. Tu potrzebny jest czÅ‚owiek."
        },
        {
            question: "Co to jest 'Race Condition' (WyÅ›cig)?",
            options: [
                "Szybkie wpisywanie hasÅ‚a.",
                "BÅ‚Ä…d wspÃ³Å‚bieÅ¼noÅ›ci, gdzie system wykonuje operacje w niewÅ‚aÅ›ciwej kolejnoÅ›ci lub rÃ³wnolegle, gdy powinien sekwencyjnie (np. dwa wÄ…tki modyfikujÄ… ten sam rekord w bazie w tym samym czasie).",
                "WyÅ›cig zbrojeÅ„ miÄ™dzy hakerami.",
                "Zbyt szybkie Å‚adowanie strony."
            ],
            correct: 1,
            explanation: "To sytuacja, gdy wynik operacji zaleÅ¼y od tego, ktÃ³ry proces dobiegnie do mety pierwszy (lub czy dobiegnÄ… w tym samym czasie)."
        },
        {
            type: "scenario",
            question: "Masz kupon jednorazowy. WysyÅ‚asz 50 Å¼Ä…daÅ„ uÅ¼ycia tego kuponu w uÅ‚amku sekundy (uÅ¼ywajÄ…c Turbo Intruder). System zaliczyÅ‚ 12 uÅ¼yÄ‡. Jak nazywa siÄ™ ten atak?",
            options: [
                "Brute Force.",
                "Race Condition (TOCTOU).",
                "SQL Injection.",
                "Parameter Pollution."
            ],
            correct: 1,
            explanation: "UdaÅ‚o Ci siÄ™ 'wstrzeliÄ‡' w okno czasowe miÄ™dzy sprawdzeniem waÅ¼noÅ›ci kuponu a jego uniewaÅ¼nieniem. Baza danych nie zdÄ…Å¼yÅ‚a siÄ™ zaktualizowaÄ‡."
        },
        {
            question: "Co oznacza skrÃ³t TOCTOU?",
            options: [
                "Time-Of-Click to Time-Of-User",
                "Time-Of-Check to Time-Of-Use",
                "Time-Out-Connection-Time-Out-User",
                "The Only Correct Time Of Use"
            ],
            correct: 1,
            explanation: "To techniczna definicja wyÅ›cigu. Czas miÄ™dzy sprawdzeniem warunku (Check) a wykonaniem akcji (Use). W tym czasie stan systemu moÅ¼e ulec zmianie."
        },
        {
            type: "scenario",
            question: "Sklep internetowy ma proces: 1. WybÃ³r towaru -> 2. PÅ‚atnoÅ›Ä‡ -> 3. WysyÅ‚ka. ZauwaÅ¼asz, Å¼e URL wysyÅ‚ki to `/shop/shipping?order_id=123`. Wpisujesz go w przeglÄ…darkÄ™ z nowym ID, pomijajÄ…c pÅ‚atnoÅ›Ä‡, i system generuje etykietÄ™ wysyÅ‚kowÄ…. Co to za bÅ‚Ä…d?",
            options: [
                "XSS",
                "Business Logic Flaw (Workflow Bypass)",
                "CSRF",
                "RCE"
            ],
            correct: 1,
            explanation: "Aplikacja zakÅ‚adaÅ‚a, Å¼e uÅ¼ytkownik grzecznie przejdzie krok po kroku. Nie zweryfikowaÅ‚a na etapie 3, czy etap 2 zostaÅ‚ zakoÅ„czony sukcesem."
        },
        {
            question: "Jak programiÅ›ci powinni broniÄ‡ siÄ™ przed Race Conditions w bazie danych?",
            options: [
                "UÅ¼ywaÄ‡ transakcji z odpowiednim poziomem izolacji (np. SELECT FOR UPDATE / Locking) lub blokad (Locks/Mutex).",
                "BlokowaÄ‡ szybkie IP.",
                "UÅ¼ywaÄ‡ szyfrowania SSL.",
                "WylÄ…czaÄ‡ bazÄ™ na noc."
            ],
            correct: 0,
            explanation: "Mechanizm blokowania wierszy (Row Locking) sprawia, Å¼e drugi wÄ…tek musi poczekaÄ‡, aÅ¼ pierwszy zakoÅ„czy transakcjÄ™. To eliminuje wyÅ›cig."
        },
        {
            type: "scenario",
            question: "W koszyku zmieniasz iloÅ›Ä‡ produktu na '-5'. Suma zamÃ³wienia spada poniÅ¼ej zera. Finalizujesz transakcjÄ™ i system dodaje Å›rodki do Twojego portfela. To przykÅ‚ad:",
            options: [
                "Integer Overflow.",
                "BÅ‚Ä™du logiki biznesowej (brak walidacji wartoÅ›ci ujemnych).",
                "SQL Injection.",
                "SSRF."
            ],
            correct: 1,
            explanation: "Programista zapomniaÅ‚ o prostej zasadzie: iloÅ›Ä‡ > 0. Matematycznie -5 * 100 = -500, wiÄ™c kod dziaÅ‚aÅ‚ 'poprawnie', ale biznesowo to katastrofa."
        },
        {
            question: "Jakie narzÄ™dzie w Burp Suite jest najlepsze do testowania Race Conditions?",
            options: [
                "Repeater (rÄ™czne klikanie).",
                "Decoder.",
                "Turbo Intruder (rozszerzenie) lub Intruder z odpowiedniÄ… konfiguracjÄ… wÄ…tkÃ³w.",
                "Scanner."
            ],
            correct: 2,
            explanation: "Turbo Intruder pozwala na wysyÅ‚anie Å¼Ä…daÅ„ z uÅ¼yciem wÅ‚asnego stosu HTTP, co umoÅ¼liwia wysÅ‚anie ostatniego bajtu wielu Å¼Ä…daÅ„ w tej samej mikrosekundzie."
        },
        {
            type: "scenario",
            question: "Aplikacja pozwala na reset hasÅ‚a tylko po podaniu 6-cyfrowego kodu SMS. Limit prÃ³b to 3. Haker wysyÅ‚a Å¼Ä…danie z poprawnym kodem i Å¼Ä…danie z bÅ‚Ä™dnym kodem w tym samym czasie. System resetuje licznik prÃ³b. Co siÄ™ staÅ‚o?",
            options: [
                "Haker zgadÅ‚ kod.",
                "WystÄ…piÅ‚ Race Condition w mechanizmie Rate Limitngu/Licznika.",
                "System siÄ™ zawiesiÅ‚.",
                "To normalne zachowanie."
            ],
            correct: 1,
            explanation: "To czÄ™sty bÅ‚Ä…d. Logika zwiÄ™kszania licznika nie byÅ‚a atomowa. RÃ³wnoczesne Å¼Ä…dania nadpisaÅ‚y wartoÅ›Ä‡ licznika niepoprawnie."
        },
        {
            question: "Dlaczego zaufanie danym obliczanym po stronie klienta (np. cena w HTML) jest bÅ‚Ä™dem?",
            options: [
                "Bo HTML jest wolny.",
                "Bo klient (przeglÄ…darka) jest pod peÅ‚nÄ… kontrolÄ… uÅ¼ytkownika. Haker moÅ¼e zmieniÄ‡ kaÅ¼dÄ… wartoÅ›Ä‡ wysyÅ‚anÄ… do serwera (Cena, IloÅ›Ä‡, Uprawnienia).",
                "Bo RODO tego zabrania.",
                "Bo serwer nie potrafi czytaÄ‡ HTML."
            ],
            correct: 1,
            explanation: "ZÅ‚ota zasada bezpieczeÅ„stwa: Never Trust Client Input. Wszelkie obliczenia (ceny, rabaty) muszÄ… byÄ‡ wykonywane ponownie na backendzie."
        }
    ];
</script>

<script src="quiz.js"></script>

</body>
</html>
