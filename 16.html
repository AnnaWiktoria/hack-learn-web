<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lekcja 16: XML & XXE - Hack & Learn</title>
    
    <link rel="stylesheet" href="style.css">

    <style>
        /* Akcent: Amber (Structure / Warnings) */
        :root {
            --accent: #ffab00;
            --accent-glow: rgba(255, 171, 0, 0.3);
        }
        
        .xml-tag { color: #ffab00; }
        .xml-attr { color: #00e5ff; }
        .xml-val { color: #fff; }
        .xml-entity { color: #ff0055; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>XML & XXE INJECTION</h1>
        <p>MODUÅ 16: Parsery XML, KradzieÅ¼ plikÃ³w i Billion Laughs Attack</p>
    </header>

    <!-- 1. MECHANIZM -->
    <section>
        <h2>> DTD: ZMIENNE W XML</h2>
        <p>XML to starszy brat JSON-a. SÅ‚uÅ¼y do przesyÅ‚ania danych. Jego unikalnÄ… cechÄ… jest <strong>DTD (Document Type Definition)</strong> â€“ sekcja na gÃ³rze pliku, gdzie moÅ¼na definiowaÄ‡ wÅ‚asne "zmienne" (Encje).</p>
        
        <div class="card">
            <h3>JAK DZIAÅA ENTITY?</h3>
            <p>To jak zmienna w programowaniu. Definiujesz jÄ… raz, uÅ¼ywasz wiele razy.</p>
            <pre><code><span class="xml-tag">&lt;!DOCTYPE</span> foo [
  <span class="xml-tag">&lt;!ENTITY</span> <span class="xml-attr">firma</span> <span class="xml-val">"Microsoft"</span>&gt;
]&gt;
<span class="xml-tag">&lt;product&gt;</span>&firma;<span class="xml-tag">&lt;/product&gt;</span></code></pre>
            <p>Parser XML zamieni <code>&firma;</code> na sÅ‚owo <code>Microsoft</code>.</p>
        </div>
    </section>

    <!-- 2. ATAK XXE -->
    <section>
        <h2>> XXE (EXTERNAL ENTITY)</h2>
        <p>Problem pojawia siÄ™, gdy uÅ¼yjesz sÅ‚owa kluczowego <strong>SYSTEM</strong>. Pozwala ono zdefiniowaÄ‡ zmiennÄ…, ktÃ³rej wartoÅ›ciÄ… jest <strong>zawartoÅ›Ä‡ pliku zewnÄ™trznego</strong>.</p>

        <div class="card">
            <h3>1. FILE DISCLOSURE (KradzieÅ¼ plikÃ³w)</h3>
            <p>AtakujÄ…cy wysyÅ‚a zÅ‚oÅ›liwy XML do API:</p>
            <pre><code><span class="xml-tag">&lt;!DOCTYPE</span> foo [
  <span class="xml-tag">&lt;!ENTITY</span> <span class="xml-entity">xxe</span> <span class="xml-tag">SYSTEM</span> <span class="xml-val">"file:///etc/passwd"</span>&gt;
]&gt;
<span class="xml-tag">&lt;user&gt;</span>&xxe;<span class="xml-tag">&lt;/user&gt;</span></code></pre>
            <p><strong>Efekt:</strong> JeÅ›li parser jest Åºle skonfigurowany (wÅ‚Ä…czone DTD), wczyta zawartoÅ›Ä‡ pliku <code>/etc/passwd</code>, wstawi go w miejsce <code>&xxe;</code> i wyÅ›wietli w odpowiedzi (np. jako nazwÄ™ uÅ¼ytkownika).</p>
        </div>

        <div class="card">
            <h3>2. SSRF VIA XXE</h3>
            <p>Zamiast pliku, moÅ¼esz podaÄ‡ adres URL.</p>
            <pre><code><span class="xml-tag">&lt;!ENTITY</span> <span class="xml-entity">xxe</span> <span class="xml-tag">SYSTEM</span> <span class="xml-val">"http://169.254.169.254/"</span>&gt;</code></pre>
            <p>Serwer poÅ‚Ä…czy siÄ™ z adresem w chmurze (AWS Metadata) lub sieciÄ… wewnÄ™trznÄ…. To klasyczny SSRF, ale wywoÅ‚any przez parser XML.</p>
        </div>
    </section>

    <!-- 3. UKRYTE WEKTORY -->
    <section>
        <h2>> GDZIE SZUKAÄ† XML?</h2>
        <p>XML nie zawsze ma rozszerzenie <code>.xml</code>. Ukrywa siÄ™ w wielu nowoczesnych formatach.</p>

        <div class="card">
            <h3>SVG (OBRAZKI) ğŸ–¼ï¸</h3>
            <p>SVG to tak naprawdÄ™ kod XML opisujÄ…cy grafikÄ™. MoÅ¼esz wstrzyknÄ…Ä‡ XXE do pliku graficznego!</p>
            <pre><code>&lt;svg width="100" height="100" xmlns="..."&gt;
  <span class="xml-tag">&lt;!DOCTYPE</span> svg [ <span class="xml-tag">&lt;!ENTITY</span> xxe SYSTEM "file:///etc/hostname"&gt; ]&gt;
  &lt;text&gt;&xxe;&lt;/text&gt;
&lt;/svg&gt;</code></pre>
            <p>JeÅ›li serwer generuje miniaturkÄ™ z tego SVG, wypisze na niej nazwÄ™ hosta serwera.</p>
        </div>

        <div class="card">
            <h3>PLIKI OFFICE (.docx, .xlsx) ğŸ“„</h3>
            <p>Pliki Worda i Excela to tak naprawdÄ™ spakowane ZIP-y zawierajÄ…ce pliki XML. MoÅ¼esz:</p>
            <ol>
                <li>ZmieniÄ‡ nazwÄ™ <code>dokument.docx</code> na <code>dokument.zip</code>.</li>
                <li>RozpakowaÄ‡, edytowaÄ‡ plik XML w Å›rodku (dodajÄ…c payload XXE).</li>
                <li>SpakowaÄ‡ ponownie i wgraÄ‡ na serwer.</li>
            </ol>
        </div>

        <div class="card" style="border-color: var(--danger);">
            <h3>BILLION LAUGHS ATTACK (DoS) ğŸ’£</h3>
            <p>Definiujesz zmiennÄ… "lol", ktÃ³ra zawiera 10 razy "lol". Potem zmiennÄ… "lol2", ktÃ³ra zawiera 10 razy "lol1"...</p>
            <p>MaÅ‚y plik XML (kilka KB) po rozpakowaniu w pamiÄ™ci zajmuje <strong>gigabajty RAM-u</strong>, zawieszajÄ…c serwer.</p>
        </div>
    </section>

    <!-- CHECKLIST -->
    <section>
        <h2>CHECKLISTA / RED FLAGS</h2>
        <div class="card checklist-card">
            <div class="checklist-item">
                <span class="check-icon">âš </span>
                <div><strong>Content-Type: application/xml:</strong> JeÅ›li API przyjmuje XML (lub SOAP), zawsze testuj XXE.</div>
            </div>
            <div class="checklist-item">
                <span class="check-icon">âš </span>
                <div><strong>Upload SVG / Excel / PDF:</strong> KaÅ¼dy parser plikÃ³w opartych na XML jest potencjalnym celem.</div>
            </div>
            <div class="checklist-item">
                <span class="check-icon">âš </span>
                <div><strong>JSON to XML converter:</strong> Czasami API przyjmuje JSON, ale moÅ¼na zmieniÄ‡ Content-Type na XML i serwer to obsÅ‚uÅ¼y (downgrade attack).</div>
            </div>
        </div>
    </section>

    <!-- QUIZ -->
    <section id="quiz-section">
        <h2>ğŸ“ WERYFIKACJA WIEDZY</h2>
        <div id="quiz-container"></div>
    </section>

    <footer>
        <p style="text-align: center; margin-top: 50px; color: #555;">&copy; 2026 Hack & Learn: Web Edition | ModuÅ‚ 16</p>
    </footer>
</div>

<!-- DANE DO QUIZU -->
<script>
    const quizData = [
        {
            question: "Co oznacza skrÃ³t XXE?",
            options: [
                "XML External Entity",
                "XSS XML Encoder",
                "Extreme XML Engine",
                "X-Ray Entity"
            ],
            correct: 0,
            explanation: "XXE to atak wykorzystujÄ…cy funkcjÄ™ parserÃ³w XML pozwalajÄ…cÄ… na Å‚adowanie zewnÄ™trznych encji (plikÃ³w lub URLi)."
        },
        {
            question: "Jaka sekcja w pliku XML jest odpowiedzialna za definiowanie encji (zmiennych)?",
            options: [
                "<body>",
                "DTD (Document Type Definition) wewnÄ…trz <!DOCTYPE>",
                "<script>",
                "<head>"
            ],
            correct: 1,
            explanation: "PodatnoÅ›Ä‡ XXE istnieje tylko wtedy, gdy parser przetwarza DTD. W bezpiecznych konfiguracjach DTD jest caÅ‚kowicie wyÅ‚Ä…czone."
        },
        {
            type: "scenario",
            question: "Chcesz odczytaÄ‡ plik `/etc/passwd`. Jakiego sÅ‚owa kluczowego uÅ¼yjesz w definicji encji?",
            options: [
                "LOCAL",
                "SYSTEM",
                "PUBLIC",
                "INCLUDE"
            ],
            correct: 1,
            explanation: "SkÅ‚adnia to: `<!ENTITY nazwa SYSTEM 'URI'>`. SÅ‚owo SYSTEM mÃ³wi parserowi: 'pobierz dane z tego ÅºrÃ³dÅ‚a'."
        },
        {
            question: "KtÃ³ry z poniÅ¼szych formatÃ³w plikÃ³w jest technicznie XML-em i moÅ¼e byÄ‡ podatny na XXE?",
            options: [
                "JPG (JPEG)",
                "SVG (Scalable Vector Graphics)",
                "MP3",
                "TXT"
            ],
            correct: 1,
            explanation: "SVG to tekstowy format wektorowy oparty na XML. PrzeglÄ…darki i serwery parsujÄ… go tak samo jak kaÅ¼dy inny plik XML."
        },
        {
            question: "Co to jest 'Billion Laughs Attack'?",
            options: [
                "Atak socjotechniczny polegajÄ…cy na wysyÅ‚aniu memÃ³w.",
                "Atak typu Denial of Service (DoS) wykorzystujÄ…cy rekurencyjne encje XML, ktÃ³re po rozwiniÄ™ciu zajmujÄ… caÅ‚Ä… pamiÄ™Ä‡ RAM serwera.",
                "Atak na hasÅ‚a.",
                "Atak na pliki dÅºwiÄ™kowe."
            ],
            correct: 1,
            explanation: "To tzw. XML Bomb. MaÅ‚y plik wejÅ›ciowy (np. encja A = 10 x B, B = 10 x C...) zamienia siÄ™ w gigabajty danych w pamiÄ™ci."
        },
        {
            question: "Czy JSON jest podatny na XXE?",
            options: [
                "Tak, zawsze.",
                "Nie, JSON nie posiada mechanizmu DTD ani zewnÄ™trznych referencji (chyba Å¼e aplikacja konwertuje JSON na XML w tle).",
                "Tak, ale tylko w Javie.",
                "ZaleÅ¼y od przeglÄ…darki."
            ],
            correct: 1,
            explanation: "JSON to prosty format danych. XML to format z 'bajerami' (jak DTD). To wÅ‚aÅ›nie te 'bajery' powodujÄ… luki bezpieczeÅ„stwa. Dlatego JSON jest bezpieczniejszy."
        },
        {
            type: "scenario",
            question: "Testujesz upload plikÃ³w `.xlsx` (Excel). Jak sprawdzisz podatnoÅ›Ä‡ XXE?",
            options: [
                "WpiszÄ™ kod SQL w komÃ³rkÄ™ arkusza.",
                "ZmieniÄ™ rozszerzenie na .zip, rozpakujÄ™, zmodyfikujÄ™ pliki XML wewnÄ…trz (dodajÄ…c payload XXE), spakujÄ™ z powrotem i wgram.",
                "ZmieniÄ™ nazwÄ™ na .exe.",
                "OtworzÄ™ plik w notatniku."
            ],
            correct: 1,
            explanation: "Dokumenty Office (Open XML) to tak naprawdÄ™ spakowane struktury XML. Serwer przy ich przetwarzaniu musi je rozpakowaÄ‡ i sparsowaÄ‡ XML."
        },
        {
            question: "Co to jest 'Blind XXE'?",
            options: [
                "Sytuacja, gdy parser wykonuje XXE, ale nie zwraca treÅ›ci pliku w odpowiedzi. AtakujÄ…cy musi uÅ¼yÄ‡ kanaÅ‚u bocznego (OOB - Out of Band), np. wysyÅ‚ajÄ…c dane na swÃ³j serwer.",
                "Atak na serwer bez monitora.",
                "Atak, ktÃ³ry nie dziaÅ‚a.",
                "Atak na pliki ukryte."
            ],
            correct: 0,
            explanation: "W Blind XXE uÅ¼ywamy np. parametru URL, by zmusiÄ‡ serwer do wysÅ‚ania zawartoÅ›ci pliku (`/etc/passwd`) jako parametru GET do naszego serwera (`hacker.com/?data=...`)."
        },
        {
            question: "Jak najlepiej zabezpieczyÄ‡ siÄ™ przed XXE?",
            options: [
                "FiltrowaÄ‡ sÅ‚owo SYSTEM.",
                "CaÅ‚kowicie wyÅ‚Ä…czyÄ‡ przetwarzanie DTD i External Entities w konfiguracji parsera XML (np. `disallow-doctype-decl` w libxml).",
                "UÅ¼ywaÄ‡ WAF.",
                "Nie uÅ¼ywaÄ‡ SVG."
            ],
            correct: 1,
            explanation: "To jedyna pewna metoda. JeÅ›li parser nie obsÅ‚uguje DTD, atak XXE jest niemoÅ¼liwy technicznie."
        },
        {
            question: "Co moÅ¼na osiÄ…gnÄ…Ä‡ dziÄ™ki XXE oprÃ³cz kradzieÅ¼y plikÃ³w?",
            options: [
                "SQL Injection.",
                "SSRF (Server-Side Request Forgery) - skanowanie sieci wewnÄ™trznej i portÃ³w z poziomu serwera.",
                "XSS w bazie danych.",
                "PrzejÄ™cie ciasteczek."
            ],
            correct: 1,
            explanation: "PoniewaÅ¼ parser XML moÅ¼e wykonywaÄ‡ Å¼Ä…dania HTTP (np. `SYSTEM 'http://localhost:8080'`), XXE jest Å›wietnym wektorem do SSRF."
        }
    ];
</script>

<script src="quiz.js"></script>

</body>
</html>