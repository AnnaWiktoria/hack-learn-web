<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lekcja 25: Secure Architecture - Hack & Learn</title>
    
    <link rel="stylesheet" href="style.css">

    <style>
        /* Akcent: Shield Cyan (Defense / Protection) */
        :root {
            --accent: #00bcd4;
            --accent-glow: rgba(0, 188, 212, 0.3);
            --good: #00e676;
            --bad: #ff1744;
        }
        
        .header-name { color: #00bcd4; font-weight: bold; }
        .header-value { color: #ccc; font-family: monospace; }
        .secure-tag { background: rgba(0, 230, 118, 0.1); color: var(--good); padding: 2px 6px; border-radius: 4px; font-size: 0.8em; border: 1px solid var(--good); }
        .insecure-tag { background: rgba(255, 23, 68, 0.1); color: var(--bad); padding: 2px 6px; border-radius: 4px; font-size: 0.8em; border: 1px solid var(--bad); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>SECURE ARCHITECTURE</h1>
        <p>MODUÅ 25: Defense in Depth, CSP Hardening i HSTS Preload</p>
    </header>

    <!-- 1. DEFENSE IN DEPTH -->
    <section>
        <h2>> OBRONA W GÅÄ„B (DEFENSE IN DEPTH)</h2>
        <p>W Blue Teamie nie wierzymy w "srebrnÄ… kulÄ™". ZakÅ‚adamy, Å¼e jedna warstwa padnie (np. programista popeÅ‚ni bÅ‚Ä…d XSS). Musi byÄ‡ druga warstwa, ktÃ³ra zablokuje skutki tego bÅ‚Ä™du.</p>
        
        <div class="card">
            <h3>ARCHITEKTURA WARSTWOWA</h3>
            <ul>
                <li><strong>Warstwa 1 (Kod):</strong> Walidacja danych i Sanityzacja (o tym w lekcji 26).</li>
                <li><strong>Warstwa 2 (NagÅ‚Ã³wki):</strong> CSP, HSTS - instrukcje dla przeglÄ…darki.</li>
                <li><strong>Warstwa 3 (SieÄ‡):</strong> WAF (Web Application Firewall).</li>
            </ul>
            <p>DziÅ› zajmiemy siÄ™ WarstwÄ… 2 â€“ czyli jak zmusiÄ‡ przeglÄ…darkÄ™, by broniÅ‚a uÅ¼ytkownika.</p>
        </div>
    </section>

    <!-- 2. CSP HARDENING -->
    <section>
        <h2>> CSP: JAK TO ZROBIÄ† DOBRZE?</h2>
        <p>WiÄ™kszoÅ›Ä‡ firm wdraÅ¼a CSP Åºle (`unsafe-inline`). Jak wdroÅ¼yÄ‡ CSP, ktÃ³re faktycznie blokuje XSS, a nie psuje strony?</p>

        <div class="card">
            <h3>ZÅOTE ZASADY CSP</h3>
            <pre><code>Content-Security-Policy: 
  default-src 'none'; 
  script-src 'self' https://trusted.com; 
  img-src 'self' data:; 
  object-src 'none'; 
  base-uri 'none';</code></pre>
            <ul>
                <li><strong>default-src 'none':</strong> DomyÅ›lnie blokuj wszystko (Deny All). Odblokuj tylko to, co niezbÄ™dne.</li>
                <li><strong>object-src 'none':</strong> Blokuje stare wtyczki (Flash/Java). Zawsze to ustawiaj.</li>
            </ul>
        </div>

        <div class="card">
            <h3>JAK Å»YÄ† BEZ 'UNSAFE-INLINE'? (NONCE)</h3>
            <p>ProgramiÅ›ci narzekajÄ…: <em>"MuszÄ™ uÅ¼yÄ‡ `unsafe-inline`, bo mam kod JS wewnÄ…trz HTML (`&lt;script&gt;var x=1&lt;/script&gt;`)"</em>.</p>
            <p><strong>RozwiÄ…zanie (Nonce):</strong></p>
            <ol>
                <li>Serwer generuje losowy ciÄ…g (nonce) przy kaÅ¼dym odÅ›wieÅ¼eniu: <code>nonce="R4nd0m"</code>.</li>
                <li>Dodaje go do nagÅ‚Ã³wka: <code>script-src 'nonce-R4nd0m'</code>.</li>
                <li>Dodaje go do tagu: <code>&lt;script nonce="R4nd0m"&gt;...&lt;/script&gt;</code>.</li>
            </ol>
            <p>Haker nie zna nonce'a, wiÄ™c jego wstrzykniÄ™ty skrypt zostanie zablokowany!</p>
        </div>
    </section>

    <!-- 3. HSTS & HTTPS -->
    <section>
        <h2>> HSTS PRELOAD</h2>
        <p>Samo przekierowanie 301 z HTTP na HTTPS to za maÅ‚o (podatne na SSL Stripping przy pierwszym wejÅ›ciu).</p>

        <div class="card">
            <h3>HSTS NA STERYDACH</h3>
            <p>PrawidÅ‚owy nagÅ‚Ã³wek produkcyjny:</p>
            <pre><code>Strict-Transport-Security: max-age=63072000; includeSubDomains; preload</code></pre>
            <ul>
                <li><strong>max-age:</strong> Min. 1 rok (w sekundach).</li>
                <li><strong>includeSubDomains:</strong> Chroni teÅ¼ <code>dev.firma.pl</code>.</li>
                <li><strong>preload:</strong> Magiczne sÅ‚owo. Pozwala wpisaÄ‡ domenÄ™ na <a href="https://hstspreload.org/" style="color:var(--accent)">listÄ™ hstspreload.org</a>.</li>
            </ul>
            <p><span class="secure-tag">EFEKT</span> Twoja domena jest "wbudowana" w Chrome/Firefoxa jako "Tylko HTTPS". PrzeglÄ…darka nigdy nie wyÅ›le do niej pakietu bez szyfrowania.</p>
        </div>
    </section>

    <!-- 4. NOWOCZESNE NAGÅÃ“WKI -->
    <section>
        <h2>> INNE TARCZE (HARDENING)</h2>
        <div class="card">
            <table>
                <tr>
                    <th>NagÅ‚Ã³wek</th>
                    <th>Co robi?</th>
                </tr>
                <tr>
                    <td><code>Permissions-Policy</code></td>
                    <td>Blokuje dostÄ™p strony do kamery, mikrofonu, USB, geolokalizacji. <br><em>Np. `camera=()` (kamera wyÅ‚Ä…czona).</em></td>
                </tr>
                <tr>
                    <td><code>Referrer-Policy</code></td>
                    <td><code>strict-origin-when-cross-origin</code>. Chroni przed wyciekiem tokenÃ³w w URL do zewnÄ™trznych stron analitycznych.</td>
                </tr>
                <tr>
                    <td><code>X-Content-Type-Options</code></td>
                    <td><code>nosniff</code>. Zapobiega traktowaniu plikÃ³w tekstowych/obrazkÃ³w jako skryptÃ³w JS.</td>
                </tr>
            </table>
        </div>
    </section>

    <!-- CHECKLIST -->
    <section>
        <h2>BLUE TEAM CHECKLIST ğŸ›¡ï¸</h2>
        <div class="card checklist-card">
            <div class="checklist-item">
                <span class="check-icon">ğŸ›¡ï¸</span>
                <div><strong>CSP Evaluator:</strong> Zawsze wrzuÄ‡ nagÅ‚Ã³wek CSP do narzÄ™dzia Google CSP Evaluator. Powie Ci, czy Twoja polityka jest dziurawa.</div>
            </div>
            <div class="checklist-item">
                <span class="check-icon">ğŸ›¡ï¸</span>
                <div><strong>Cookie Flags:</strong> Czy WSZYSTKIE ciastka majÄ… `Secure`, `HttpOnly` i `SameSite=Strict/Lax`?</div>
            </div>
            <div class="checklist-item">
                <span class="check-icon">ğŸ›¡ï¸</span>
                <div><strong>Usuwanie nagÅ‚Ã³wkÃ³w:</strong> UsuÅ„ `Server: Apache` i `X-Powered-By: PHP`. Nie pomagaj atakujÄ…cemu w rekonesansie.</div>
            </div>
        </div>
    </section>

    <!-- QUIZ -->
    <section id="quiz-section">
        <h2>ğŸ“ WERYFIKACJA WIEDZY OBRONNEJ</h2>
        <div id="quiz-container"></div>
    </section>

    <footer>
        <p style="text-align: center; margin-top: 50px; color: #555;">&copy; 2026 Hack & Learn: Web Edition | ModuÅ‚ 25</p>
    </footer>
</div>

<!-- DANE DO QUIZU -->
<script>
    const quizData = [
        {
            question: "Co oznacza zasada 'Defense in Depth' (Obrona w gÅ‚Ä…b)?",
            options: [
                "Ukrywanie serwerÃ³w gÅ‚Ä™boko pod ziemiÄ….",
                "Stosowanie wielu warstw zabezpieczeÅ„ (kod, nagÅ‚Ã³wki, sieÄ‡), tak aby przeÅ‚amanie jednej nie oznaczaÅ‚o kompromitacji caÅ‚ego systemu.",
                "UÅ¼ywanie bardzo dÅ‚ugich haseÅ‚.",
                "Obrona tylko przed atakami Deep Web."
            ],
            correct: 1,
            explanation: "Nikt nie pisze kodu idealnego. NagÅ‚Ã³wki (Warstwa 2) sÄ… po to, by ratowaÄ‡ sytuacjÄ™, gdy programista popeÅ‚ni bÅ‚Ä…d w kodzie (Warstwa 1)."
        },
        {
            type: "scenario",
            question: "Programista mÃ³wi: 'Nie mogÄ™ wdroÅ¼yÄ‡ CSP, bo uÅ¼ywam skryptÃ³w inline w HTML'. JakÄ… bezpiecznÄ… alternatywÄ™ dla 'unsafe-inline' mu zaproponujesz?",
            options: [
                "RezygnacjÄ™ z CSP.",
                "UÅ¼ycie mechanizmu 'Nonce' (kryptograficznego, jednorazowego tokena) dodawanego do nagÅ‚Ã³wka CSP i tagÃ³w <script>.",
                "Przeniesienie kodu do plikÃ³w .txt.",
                "UÅ¼ycie 'unsafe-eval'."
            ],
            correct: 1,
            explanation: "Nonce to jednorazowa przepustka. Serwer mÃ³wi: 'Ufam temu konkretnemu blokowi kodu, bo ma wÅ‚aÅ›ciwy identyfikator'. Haker nie zna identyfikatora, wiÄ™c jego kod nie zadziaÅ‚a."
        },
        {
            question: "Co daje flaga 'preload' w nagÅ‚Ã³wku HSTS?",
            options: [
                "Szybsze Å‚adowanie strony.",
                "UmoÅ¼liwia wpisanie domeny na sztywnÄ… listÄ™ w przeglÄ…darkach (HSTS Preload List). DziÄ™ki temu nawet PIERWSZE poÅ‚Ä…czenie uÅ¼ytkownika z domenÄ… jest wymuszane po HTTPS.",
                "WstÄ™pne Å‚adowanie obrazkÃ³w.",
                "BlokadÄ™ portu 80."
            ],
            correct: 1,
            explanation: "Bez preloadu, pierwsze poÅ‚Ä…czenie (np. wpisanie 'bank.com' w pasek adresu) idzie po HTTP i jest podatne na atak SSL Strip. Preload eliminuje to ryzyko."
        },
        {
            question: "Dlaczego nagÅ‚Ã³wek `X-Content-Type-Options: nosniff` jest waÅ¼ny?",
            options: [
                "Zapobiega wÄ…chaniu pakietÃ³w.",
                "Zmusza przeglÄ…darkÄ™ do Å›cisÅ‚ego przestrzegania zadeklarowanego typu pliku (MIME type). Zapobiega to wykonaniu pliku `avatar.jpg` jako skryptu JS, jeÅ›li serwer pomyliÅ‚ nagÅ‚Ã³wki.",
                "Blokuje pobieranie plikÃ³w.",
                "Ukrywa rozszerzenia plikÃ³w."
            ],
            correct: 1,
            explanation: "PrzeglÄ…darki lubiÄ… 'zgadywaÄ‡' typ pliku (MIME Sniffing). JeÅ›li w pliku tekstowym znajdÄ… HTML, mogÄ… go wykonaÄ‡. `nosniff` mÃ³wi: 'Nie zgaduj, ufaj serwerowi'."
        },
        {
            question: "Co robi dyrektywa `object-src 'none'` w CSP?",
            options: [
                "Blokuje obiekty JSON.",
                "Blokuje Å‚adowanie wtyczek takich jak Flash, Java Applets czy ActiveX. To dobra praktyka hardeningu, bo te technologie sÄ… przestarzaÅ‚e i niebezpieczne.",
                "Blokuje programowanie obiektowe.",
                "Blokuje tag <img>."
            ],
            correct: 1,
            explanation: "Nawet jeÅ›li nie uÅ¼ywasz Flasha, haker moÅ¼e sprÃ³bowaÄ‡ go zaÅ‚adowaÄ‡, by wykorzystaÄ‡ luki w przeglÄ…darce. Zablokowanie obiektÃ³w zamyka ten wektor ataku."
        },
        {
            type: "scenario",
            question: "Audytujesz stronÄ™ i widzisz nagÅ‚Ã³wek `Server: nginx/1.14.0 (Ubuntu)`. JakÄ… rekomendacjÄ™ wpiszesz do raportu (kategoria Hardening)?",
            options: [
                "ZaktualizowaÄ‡ Ubuntu.",
                "SkonfigurowaÄ‡ serwer tak, aby ukrywaÅ‚ dokÅ‚adnÄ… wersjÄ™ oprogramowania (np. tylko `Server: nginx`). To utrudnia rekonesans (tzw. Server Banner Grabbing).",
                "ZmieniÄ‡ serwer na Apache.",
                "To nie jest bÅ‚Ä…d."
            ],
            correct: 1,
            explanation: "Zasada minimalizacji informacji. JeÅ›li haker wie, Å¼e masz wersjÄ™ 1.14.0, od razu sprawdzi w Google: 'nginx 1.14.0 exploits'. Nie uÅ‚atwiaj mu zadania."
        },
        {
            question: "Jaki nagÅ‚Ã³wek pozwala kontrolowaÄ‡ dostÄ™p strony do kamery i mikrofonu uÅ¼ytkownika?",
            options: [
                "Content-Security-Policy",
                "Permissions-Policy (dawniej Feature-Policy)",
                "X-Frame-Options",
                "Access-Control-Allow-Media"
            ],
            correct: 1,
            explanation: "Ustawienie `Permissions-Policy: camera=(), microphone=()` gwarantuje, Å¼e nawet jeÅ›li ktoÅ› wstrzyknie zÅ‚oÅ›liwy kod (XSS), nie bÄ™dzie mÃ³gÅ‚ podglÄ…daÄ‡ uÅ¼ytkownika."
        }
    ];
</script>

<script src="quiz.js"></script>

</body>
</html>